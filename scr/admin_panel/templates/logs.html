{% extends "base.html" %}
{% block content %}
  <h3 class="mb-4"><i class="fa-solid fa-scroll"></i> –õ–æ–≥–∏</h3>

  <div class="d-flex align-items-center mb-3">
    <button id="toggleAutoUpdate" class="btn btn-outline-primary me-2">
      <i class="fa-solid fa-rotate"></i> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤—ã–∫–ª
    </button>
    <input id="intervalInput" type="number" class="form-control" value="5" min="1" style="width:100px">
    <span class="ms-2">—Å–µ–∫—É–Ω–¥</span>
  </div>

  <div class="card shadow-sm">
    <div class="card-body bg-dark text-light" style="max-height:70vh; overflow:auto; font-family: monospace;">
      <pre id="logContent" class="m-0">{{ logs }}</pre>
    </div>
  </div>

  <script>
    let autoUpdate = false;
    let intervalId = null;

    const logContent = document.getElementById("logContent");
    const toggleBtn = document.getElementById("toggleAutoUpdate");
    const intervalInput = document.getElementById("intervalInput");

    async function fetchLogs() {
      const resp = await fetch("/logs?ajax=1");
      const text = await resp.text();
      logContent.textContent = text;
    }

    toggleBtn.addEventListener("click", () => {
      autoUpdate = !autoUpdate;
      if (autoUpdate) {
        toggleBtn.textContent = "‚èπ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤–∫–ª";
        toggleBtn.classList.remove("btn-outline-primary");
        toggleBtn.classList.add("btn-success");

        const seconds = parseInt(intervalInput.value) || 5;
        intervalId = setInterval(fetchLogs, seconds * 1000);
      } else {
        toggleBtn.textContent = "üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤—ã–∫–ª";
        toggleBtn.classList.remove("btn-success");
        toggleBtn.classList.add("btn-outline-primary");

        clearInterval(intervalId);
      }
    });
  </script>
{% endblock %}
